# /etc/rsyslog.d/50-default.conf
# JSON lines to per-host/per-app files

# 1) Template for one JSON object per line
template(name="jsonline" type="list") {
  constant(value="{")
    constant(value="\"time\":\"")     property(name="timereported" dateFormat="rfc3339")
    constant(value="\",\"host\":\"")  property(name="hostname")
    constant(value="\",\"app\":\"")   property(name="programname")
    constant(value="\",\"pri\":\"")   property(name="pri")
    constant(value="\",\"msg\":")     property(name="msg" format="json")
  constant(value="}\n")
}

# 2) Template that builds the dynamic file path
template(name="plDynFile" type="string"
         string="/var/log/pocketlog/%hostname%/%programname%.log")

# 3) Action: write to the dynamic path, creating directories as needed
action(
  type="omfile"
  DynaFile="plDynFile"
  template="jsonline"
  createDirs="on"
)
